#!/bin/sh

#**********************************************************************#
#                                                                      #
#                        FoCaLiZe compiler                             #
#                                                                      #
#            François Pessaux                                          #
#            Pierre Weis                                               #
#            Damien Doligez                                            #
#                                                                      #
#                               LIP6  --  INRIA Rocquencourt           #
#                                                                      #
#  Copyright 2008 INRIA                                                #
#  Distributed only by permission.                                     #
#                                                                      #
#**********************************************************************#

# $Id: configure,v 1.73 2012-10-15 14:35:15 pessaux Exp $

BOLDTAG="\033[1m"
UNDERLINETAG="\033[4m"
NORMALTAG="\033[0m"

INSTALL_PREFIX=/usr/local
INSTALL_BIN_DIR=${INSTALL_PREFIX}/bin
INSTALL_LIB_DIR=${INSTALL_PREFIX}/lib/zenon

# First recover the configuration file providing the name of ocaml and coq commands.
if [ -f "../.config_var" ] ;
    then
    source ../.config_var
else
    echo "Error.Global configuration file not found."
    echo "Run ./configure from the parent directory."
    exit 1
fi

# Look for a hash command.
check_command () {
  type "$1" >/dev/null 2>&1
}

SUM_COMMAND=""
for i in sum md5 md5sum md5deep sha1deep sha256deep; do
  if check_command $i ; then SUM_COMMAND=$i ; break ; fi
done

# Installation stuff.
echo $BOLDTAG"Where to install Zenon binaries ?"$NORMALTAG
echo "Default is $INSTALL_BIN_DIR."
echo "Just press enter to use default location."
read USER_INPUT
if [ "$USER_INPUT" != "" ] ;
   then
   INSTALL_BIN_DIR=$USER_INPUT
fi

echo $BOLDTAG"Where to install Zenon libraries ?"$NORMALTAG
echo "Default is $INSTALL_LIB_DIR."
echo "Just press enter to use default location."
read USER_INPUT
if [ "$USER_INPUT" != "" ] ;
   then
   INSTALL_LIB_DIR=$USER_INPUT
fi

# #############################################################################
# Generate the installation and configuration file containing tools vars.
CONFIGURATION_VARS_FILE=.config_var

rm -f $CONFIGURATION_VARS_FILE
echo "INSTALL_BIN_DIR=$INSTALL_BIN_DIR" >> $CONFIGURATION_VARS_FILE
echo "INSTALL_LIB_DIR=$INSTALL_LIB_DIR" >> $CONFIGURATION_VARS_FILE
echo "SUM=$SUM_COMMAND" >> $CONFIGURATION_VARS_FILE
chmod a-w $CONFIGURATION_VARS_FILE

# #############################################################################
# Summary feedback.
echo "Configuration summary for Zenon:"
echo "  binaries -> $INSTALL_BIN_DIR"
echo "  libraries -> $INSTALL_LIB_DIR"
echo "  checksum command: $SUM_COMMAND"
echo "Done."
