#!/bin/sh

#  Copyright 2004 INRIA
#  $Id: configure,v 1.23 2008-09-17 11:09:12 doligez Exp $

check(){
  type "$1" >/dev/null 2>&1
}

exec_prefix=/usr/local
prefix=
bindir=/usr/local/bin
libdir=/usr/local/lib/zenon
debug=true
if check convert; then convert=convert; else convert=:; fi
if check coqc; then coqc=coqc; else coqc=:; fi
if check gs; then gs=gs; else gs=:; fi

sum=:
for i in sum md5 md5sum md5deep sha1deep sha256deep; do
  if check $i; then sum=$i; break; fi
done

while : ; do
  case $# in 0) break;; esac
  case "$1" in
    -bindir | --bindir) bindir="$2"; shift 2;;
    -convert | --convert) convert="$2"; shift 2;;
    -coqc | --coqc) coqc="$2"; shift 2;;
    -debug | --debug | --enable-debug) debug=true; shift;;
    -exec_prefix | --exec_prefix) exec_prefix="$2"; shift 2;;
    -gs | --gs) gs="$2"; shift 2;;
    -libdir | --libdir) libdir="$2"; shift 2;;
    -nodebug | --nodebug | --disable-debug) debug=false; shift;;
    -prefix | --prefix) prefix="$2"; shift 2;;
    -sum | --sum) sum="$2"; shift 2;;
    *) echo 'usage: ./configure [options]' >&2
       echo 'options are:' >&2
       echo '  [-]-bindir <directory>' >&2
       echo '  [-]-convert <exec-file>' >&2
       echo '  [-]-coq <exec-file>' >&2
       echo '  [-]-debug | --enable-debug' >&2
       echo '  [-]-exec_prefix <directory>' >&2
       echo '  [-]-gs <exec-file>' >&2
       echo '  [-]-libdir <directory>' >&2
       echo '  [-]-nodebug | --disable-debug' >&2
       echo '  [-]-prefix <directory>' >&2
       echo '  [-]-sum <exec-file>' >&2
       exit 2
    ;;
  esac
done

if $debug; then
  bytdebugflags="-g"
  optdebugflags="-dtypes"
else
  bytdebugflags=
  optdebugflags=
fi

sed -e "s,@BINDIR@,$prefix$bindir," \
    -e "s,@BYTDEBUGFLAGS@,$bytdebugflags," \
    -e "s,@CONVERT@,$convert," \
    -e "s,@COQC@,$coqc," \
    -e "s,@exec_prefix@,$exec_prefix," \
    -e "s,@GS@,$gs," \
    -e "s,@LIBDIR@,$prefix$libdir," \
    -e "s,@OPTDEBUGFLAGS@,$optdebugflags," \
    -e "s,@SUM@,$sum," \
    <.config_var.in >.config_var

echo Configuration summary for zenon:
cat .config_var
